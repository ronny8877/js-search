<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE us-patent-application SYSTEM "us-patent-application-v40-2004-12-02.dtd" [ ]>
<us-patent-application lang="EN" dtd-version="v4.0 2004-12-02" file="US20050138309A1-20050623.XML" status="PRODUCTION" id="us-patent-application" country="US" date-produced="20050608" date-publ="20050623">
<us-bibliographic-data-application lang="EN" country="US">
<publication-reference>
<document-id>
<country>US</country>
<doc-number>20050138309</doc-number>
<kind>A1</kind>
<date>20050623</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>10801718</doc-number>
<date>20040317</date>
</document-id>
</application-reference>
<us-application-series-code>10</us-application-series-code>
<us-publication-filing-type>
<us-original-publication-voluntary/>
</us-publication-filing-type>
<priority-claims>
<priority-claim sequence="01" kind="national">
<country>JP</country>
<doc-number>2003-423464</doc-number>
<date>20031219</date>
</priority-claim>
</priority-claims>
<classification-ipc>
<edition>07</edition>
<main-classification>G06F012/00</main-classification>
</classification-ipc>
<classification-national>
<country>US</country>
<main-classification>711162000</main-classification>
</classification-national>
<invention-title id="d0e79">Data duplication control method</invention-title>
<parties>
<applicants>
<applicant sequence="00" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Hiraiwa</last-name>
<first-name>Yuri</first-name>
<address>
<city>Sagamihara</city>
<country>JP</country>
</address>
</addressbook>
<nationality>
<country>JP</country>
</nationality>
<residence>
<country>JP</country>
</residence>
</applicant>
<applicant sequence="01" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Inoue</last-name>
<first-name>Taro</first-name>
<address>
<city>Yamato</city>
<country>JP</country>
</address>
</addressbook>
<nationality>
<country>JP</country>
</nationality>
<residence>
<country>JP</country>
</residence>
</applicant>
<applicant sequence="02" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Goto</last-name>
<first-name>Sumio</first-name>
<address>
<city>Yokohama</city>
<country>JP</country>
</address>
</addressbook>
<nationality>
<country>JP</country>
</nationality>
<residence>
<country>JP</country>
</residence>
</applicant>
</applicants>
<correspondence-address>
<addressbook>
<name>MATTINGLY, STANGER &#x26; MALUR, P.C.</name>
<address>
<address-1>SUITE 370</address-1>
<address-2>1800 DIAGONAL ROAD</address-2>
<city>ALEXANDRIA</city>
<state>VA</state>
<postcode>22314</postcode>
<country>US</country>
</address>
</addressbook>
</correspondence-address>
</parties>
</us-bibliographic-data-application>
<abstract id="abstract">
<p id="p-0001" num="0000">In the present invention, when there is a change in a group of volumes managed by a host computer, data duplication processing is immediately carried out against the changed volume. The host computer <b>10 </b>comprises a volume-managing portion(unit) <b>12</b>, a data duplication-controlling portion(unit) <b>11 </b>which executes the data duplication of the data stored in the volume <b>32 </b>in the main data center <b>3</b>, and a data duplication storing portion(unit) <b>13 </b>which stores data necessary for the data duplication. The data duplication-controlling portion <b>11 </b>compares data held by the volume-managing portion <b>12 </b>and the data in the data duplication storing portion <b>13</b>, and updates the data in the data duplication storing portion <b>13 </b>based on the data held by the volume-managing portion <b>12. </b></p>
</abstract>
<drawings id="DRAWINGS">
<figure id="figure-D00000" num="00000">
<img id="EMI-D00000" he="166.50mm" wi="131.57mm" file="US20050138309A1-20050623-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="figure-D00001" num="00001">
<img id="EMI-D00001" he="248.67mm" wi="202.01mm" file="US20050138309A1-20050623-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="figure-D00002" num="00002">
<img id="EMI-D00002" he="215.22mm" wi="158.58mm" file="US20050138309A1-20050623-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="figure-D00003" num="00003">
<img id="EMI-D00003" he="242.40mm" wi="190.08mm" file="US20050138309A1-20050623-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="figure-D00004" num="00004">
<img id="EMI-D00004" he="150.62mm" wi="189.31mm" file="US20050138309A1-20050623-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="figure-D00005" num="00005">
<img id="EMI-D00005" he="241.72mm" wi="183.39mm" file="US20050138309A1-20050623-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="figure-D00006" num="00006">
<img id="EMI-D00006" he="237.49mm" wi="174.50mm" file="US20050138309A1-20050623-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="figure-D00007" num="00007">
<img id="EMI-D00007" he="253.41mm" wi="192.70mm" file="US20050138309A1-20050623-D00007.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="figure-D00008" num="00008">
<img id="EMI-D00008" he="244.86mm" wi="193.12mm" file="US20050138309A1-20050623-D00008.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="figure-D00009" num="00009">
<img id="EMI-D00009" he="251.12mm" wi="192.70mm" file="US20050138309A1-20050623-D00009.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="figure-D00010" num="00010">
<img id="EMI-D00010" he="204.98mm" wi="188.04mm" file="US20050138309A1-20050623-D00010.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?summary-of-invention description="Summary of Invention" end="lead"?>
<heading level="2" id="h-0001">BACKGROUND OF THE INVENTION </heading>
<p id="p-0002" num="0001"> The present invention relates to a technique of data duplication control in a computer system. </p>
<p id="p-0003" num="0002"> It is a matter of course that as for a public or corporate infrastructure system, being responsible for social infrastructure, a high availability is pursued. In particular, nowadays, it is necessary to devise a countermeasure as to recovery works (disaster recovery) of the system after the event of disaster. In this regard, data stored in a main data center (site) is copied in a storage device at a sub data center as data backup. With this configuration, it is possible to continue operations even in disaster situations, by use of the data copied in the storage at the sub data center. </p>
<p id="p-0004" num="0003"> For example, Japanese Patent Laid-open Publication No. 2001-318833 (hereinafter, referred to as &#x201c;Patent Document 1&#x201d;) discloses a storage subsystem having a volume copying function to copy data by volume. Here, the &#x201c;volume&#x201d; indicates a logical unit to manage a storage medium (for example, a magnetic disk and the like) for storing data. </p>
<p id="p-0005" num="0004"> In Japanese Patent Laid-open Publication No. 2003-122509 (hereinafter, referred to as &#x201c;Patent Document 2&#x201d;) there is disclosed a disaster recovery system which performs data transfer among three data centers. This disaster discovery system holds data in each of the three data centers, thereby reducing data loss, as well as it maintains a configuration being prepared for disaster recovery, even after one data center is lost in the event of a disaster. Here, the &#x201c;data loss&#x201d; indicates that if a transfer delay occurs due to a long distance between the data centers and a disaster occurs during the delay time, data that is to be transferred during that time will be lost. </p>
<heading level="2" id="h-0002">SUMMARY OF THE INVENTION </heading>
<p id="p-0006" num="0005"> Usually, data duplication is carried out by selecting a volume where the data that is required to be duplicated is stored, and by copying the data in units of volume. Therefore, a host computer responsible for business processing holds information of a volume which stores important information in the business processing, i.e., a volume required to be duplicated. </p>
<p id="p-0007" num="0006"> When a volume to be used is added due to increase of data for executing business processing, it is also necessary to duplicate thus added volume. In order to keep consistency between data, the copying sequence should be assured when data is copied. Therefore, it is required that the volume newly added is immediately duplicated. However, in a conventional system, timing for such volume addition has not been taken into account. </p>
<p id="p-0008" num="0007"> Furthermore, in the Patent Document 1, there is described that a secondary volume as a data copying destination is allocated (selected) within one disk subsystem. However, there is no consideration regarding a case that which subsystem is to be selected if multiple disk subsystems exist. Further in the Patent Document 1, the data duplication within a multistage data center configuration (among at least three data centers) as described in the Patent Document 2 is not considered either. </p>
<p id="p-0009" num="0008"> The present invention has been made in view of the above situations, and a feature of the present invention is as the following: if there is a change in a group of volumes that are managed by a host computer, data duplication processing is immediately executed against the volume having been changed. </p>
<p id="p-0010" num="0009"> In order to solve the above problems, in the present invention, volume information managed by the host computer and duplication definition information for carrying out the data duplication are compared, and the duplication definition information is updated based on a result of the comparison. </p>
<p id="p-0011" num="0010"> For example, the present invention comprises, 
<ul id="ul0001" list-style="none">
    <li id="ul0001-0001" num="0000">
    <ul id="ul0002" list-style="none">
        <li id="ul0002-0001" num="0011"> an identification information reading step which reads out from a storing portion(unit) an identification information list in which identification information of each of a plurality of storage media included in the storage subsystem is stored, </li>
        <li id="ul0002-0002" num="0012"> a first reading step which reads out from the storing portion a first duplication definition information which stores the identification information with respect to each of the plurality of storage media, and identification information of a copy destination storage medium of each of the plurality of storage media, and </li>
        <li id="ul0002-0003" num="0013"> a first comparing step which compares the identification information list read out in the identification information reading step, and the first duplication definition information read out in the first reading step. </li>
    </ul>
    </li>
</ul>
</p>
<p id="p-0012" num="0014"> The present invention further comprises, 
<ul id="ul0003" list-style="none">
    <li id="ul0003-0001" num="0000">
    <ul id="ul0004" list-style="none">
        <li id="ul0004-0001" num="0015"> an addition step in which if there exists identification information that is stored in the identification information list but not stored in the first duplication definition information in the first comparing step, a copy destination recording medium of the storage medium having the identification information is selected according to a predetermined selection condition, the identification information and the identification information of the copy destination storage medium thus selected are added to the first duplication definition information, and data in the storage medium having the identification information is copied to the copy destination storage medium thus selected, and </li>
        <li id="ul0004-0002" num="0016"> a deletion step in which if there exists identification information that is not stored in the identification information list but is stored in the first duplication definition information in the first comparing step, the identification information and the identification information of the storage medium, which is a copy destination of the storage medium having the identification information, are deleted from the first duplication definition information, and copying the data of the storage medium having the identification information is stopped. </li>
    </ul>
    </li>
</ul>
</p>
<p id="p-0013" num="0017"> According to the present invention, if there is a change in a group of volumes that are managed by the host computer, data duplication processing is immediately executed against the volume having been changed. </p>
<?summary-of-invention description="Summary of Invention" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<heading level="2" id="h-0003">BRIEF DESCRIPTION OF DRAWINGS </heading>
<p id="p-0014" num="0018"> <figref idref="DRAWINGS">FIG. 1</figref> is a schematic diagram showing a computer system to which one of the embodiments of the present invention is applied. </p>
<p id="p-0015" num="0019"> <figref idref="DRAWINGS">FIG. 2</figref> is a diagram showing an example of a hardware configuration of the computer system. </p>
<p id="p-0016" num="0020"> <figref idref="DRAWINGS">FIG. 3</figref> is a diagram showing an example of data structure of data duplication configuration-storing portion(unit). </p>
<p id="p-0017" num="0021"> <figref idref="DRAWINGS">FIG. 4</figref> is a diagram showing an example of data structure of copy group definition data. </p>
<p id="p-0018" num="0022"> <figref idref="DRAWINGS">FIG. 5</figref> is a diagram showing an example of data structure of copy group relation definition data. </p>
<p id="p-0019" num="0023"> <figref idref="DRAWINGS">FIG. 6</figref> is a diagram showing an example of data structure of duplication condition data. </p>
<p id="p-0020" num="0024"> <figref idref="DRAWINGS">FIG. 7</figref> is a diagram showing an example of data structure of disk subsystem configuration data. </p>
<p id="p-0021" num="0025"> <figref idref="DRAWINGS">FIG. 8</figref> is a diagram showing a flowchart of processing in the data duplication-controlling portion(unit). </p>
<p id="p-0022" num="0026"> <figref idref="DRAWINGS">FIG. 9</figref> is a diagram showing a flowchart of volume addition processing in the data duplication-controlling portion(unit). </p>
<p id="p-0023" num="0027"> <figref idref="DRAWINGS">FIG. 10</figref> is a diagram showing a flowchart of volume deletion processing in the data duplication-controlling portion(unit). </p>
<p id="p-0024" num="0028"> <figref idref="DRAWINGS">FIG. 11</figref> is a schematic diagram showing a computer system to which provides a management computer. </p>
<p id="p-0025" num="0029"> <figref idref="DRAWINGS">FIG. 12</figref> is a diagram showing an example of GUI to which the host computer system <b>1</b> or the management computer has.</p>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?detailed-description description="Detailed Description" end="lead"?>
<heading level="2" id="h-0004">DETAILED DESCRIPTION OF THE PREFERRED EMBODIMENTS </heading>
<p id="p-0026" num="0030"> Preferred embodiments of the present invention will be explained as the following. </p>
<p id="p-0027" num="0031"> In the data duplication processing of the present embodiment, a volume or copy source is referred to as &#x201c;a primary volume&#x201d;, and a volume of copy destination is referred to as &#x201c;a secondary volume&#x201d;. A pair of the &#x201c;primary volume and the &#x201c;secondary volume&#x201d; is referred to as &#x201c;a pair&#x201d;. Here, it is assumed that in the data duplication processing, there are a synchronous remote copy and an asynchronous remote copy as described in the Patent Document 2. Specifically, the synchronous remote copy is a method as the following: When an update instruction (writing instruction) is issued to the primary volume from a host computer and the like, copying to the secondary volume is continuously carried out in sync with the update instruction. On the other hand, the asynchronous remote copy is as the following: When an update instruction (writing instruction) is issued to the primary volume from a host computer and the like, copying to the secondary volume is carried out at irregular intervals irrespective of the update instruction. </p>
<p id="p-0028" num="0032"> As for a method for selecting a secondary volume within a predetermined disk subsystem, the method described in the patent document 1 will be used. That is, according to a secondary volume selection instruction from the host computer, the disk subsystem selects a volume, not in use and having larger disk volume than that of the primary volume, within the disk subsystem, and notifies the host computer of thus selected volume. </p>
<p id="p-0029" num="0033"> <figref idref="DRAWINGS">FIG. 1</figref> is a schematic diagram of a computer system to which one embodiment of the present invention has been applied. This system comprises a host computer system <b>1</b>, disk subsystem <b>30</b> of a main data center <b>3</b>, a disk subsystem <b>40</b> of a local data center <b>4</b>, and a disk subsystem <b>50</b> of a remote data center <b>5</b>. The main data center <b>3</b>, the local data center <b>4</b>, and the remote data center <b>5</b> respectively include a plurality of disk subsystems <b>30</b>, disk subsystems <b>40</b>, and disk subsystems <b>50</b>. </p>
<p id="p-0030" num="0034"> Here, it is assumed that the data duplication processing between the main data center <b>3</b> and the local data center <b>4</b> is based on the synchronous remote copy, and the data duplication processing between the local data center <b>4</b> and the remote data center <b>5</b> is based on the asynchronous remote copy. It is further assumed that each of the connection between the main data center <b>3</b> and the local data center <b>4</b>, and the connection between the local data center <b>4</b> and the remote data center <b>5</b> is established via a network <b>2</b> such as intranet. </p>
<p id="p-0031" num="0035"> In the present embodiment, as for these data centers <b>3</b> to <b>5</b>, each of the disk subsystems <b>30</b>, <b>40</b> and <b>50</b>, respectively of the main data center <b>3</b>, the local data center <b>4</b>, and the remote data center <b>5</b> are serially connected, setting the host computer system <b>1</b> as a base point. In other words, firstly, the volume <b>32</b> of the main data center <b>3</b> is defined as a primary volume that is a copy source, and the volume <b>42</b> of the local data center <b>4</b> is defined as a secondary volume, so that those two volumes are defined as a first pair. Furthermore, the volume <b>42</b> of the local data center <b>4</b> is defined as a primary volume and the volume <b>52</b> of the remote data center <b>5</b> is defined as a secondary volume, so that those two volumes are defined as a second pair. With this configuration, it is possible to make a copy of the volume <b>32</b> of the main data center <b>3</b> in the remote data center <b>5</b>. </p>
<p id="p-0032" num="0036"> It is to be noted that each of the volumes in the first pair where the volume <b>32</b> of the main data center <b>3</b> is defined as a primary volume and the second pair where the volume <b>42</b> of the local data center <b>4</b> is defined as a primary volume, are collectively referred to as a volume image set <b>6</b>. </p>
<p id="p-0033" num="0037"> In the present embodiment, the data centers are in three stages, i.e., the main data center <b>3</b>, the local data center <b>4</b> and the remote data center <b>5</b>. However, the present invention is not limited to this configuration, and data centers in two stages or four or more stages may be applicable. </p>
<p id="p-0034" num="0038"> The host computer system <b>1</b> comprises a host computer <b>10</b> and a host computer SVP (Service Processor) <b>20</b>. The host computer <b>10</b> is a general-purpose computer unit which executes various data processing procedures (so-called business processing). The host computer <b>10</b> comprises a data duplication-controlling portion(unit) <b>11</b>, a volume-managing portion(unit) <b>12</b>, a data duplication configuration-storing portion(unit) <b>13</b>, an I/O configuration-storing portion(unit) <b>14</b>, and an input-output portion(unit) <b>15</b>. </p>
<p id="p-0035" num="0039"> The data duplication-controlling portion <b>11</b> controls so-called data duplication processing, in which a copy is made by volume as to the data stored in the disk subsystem <b>30</b> of the main data center <b>3</b>, to the disk subsystems <b>40</b>, <b>50</b> of the local data center <b>4</b> and the remote data center <b>5</b>. </p>
<p id="p-0036" num="0040"> The volume-managing portion <b>12</b> serves as a function of the operating system (referred to as &#x201c;OS&#x201d; in the following), which is not illustrated, and provides an application program (business processing program) with the volumes in the disk subsystems collectively as one virtual volume group. Furthermore, the volume-managing portion <b>12</b> manages this virtual volume group, and outputs management information of the volumes (for example, a list of VOLSER) included in the volume group. The &#x201c;VOLSER&#x201d; represents &#x201c;volume serial number&#x201d; that is allocated to identify individual volumes. It is assumed in the present embodiment that the volume-managing portion <b>12</b> has one volume group. </p>
<p id="p-0037" num="0041"> The data duplication configuration-storing portion <b>13</b> stores information necessary for the data duplication-controlling portion <b>11</b> to execute the data duplication processing, and this will be explained below with reference to <figref idref="DRAWINGS">FIG. 3</figref> to <figref idref="DRAWINGS">FIG. 7</figref>. </p>
<p id="p-0038" num="0042"> The I/O configuration-storing portion <b>14</b> stores configuration information of various I/O devices including the disk subsystems connected to the host computer <b>10</b>. When the host computer <b>10</b> is started up, the OS expands on a memory (main memory) the information stored in the I/O configuration-storing portion <b>14</b>. </p>
<p id="p-0039" num="0043"> The input-output portion <b>15</b> carries out data transfer between the various I/O devices including the disk subsystem and the memory, based on the information stored in the I/O configuration-storing portion <b>14</b>. The CPU in the host computer <b>10</b> accesses the disk subsystem via the input-output portion <b>15</b>, and refers to and updates data. The host computer SVP <b>20</b> is a sub processor to monitor or operate the host computer <b>10</b>, and it is used as a console. </p>
<p id="p-0040" num="0044"> The main data center <b>3</b> comprises a plurality of subsystems <b>30</b> which are connected to the host computer <b>10</b>. Each of the disk subsystems <b>30</b> includes a disk controller <b>31</b>, a plurality of volumes <b>32</b>, and a disk subsystem SVP <b>33</b>. The disk controller <b>31</b> controls the volume <b>32</b>, such as data input and output, based on an instruction from the host computer <b>10</b>. It is to be noted that the disk controller <b>31</b> also executes a process for selecting a secondary volume as described in the Patent Document 1. In other words, according to the instruction from the host computer <b>10</b> to select a secondary volume, the disk controller <b>31</b> selects a volume within the disk subsystem, not in use and having larger disk volume than that of the primary volume, and notifies the host computer of thus selected volume. </p>
<p id="p-0041" num="0045"> The volume <b>32</b> is storage medium for storing data, such as magnetic disk, and it is a logical unit to manage the storage medium. Therefore, a plurality of physical magnetic disks may be stored in one volume <b>32</b>, or it is possible to define a plurality of magnetic disks as one volume. The disk subsystem SVP <b>33</b> is a sub processor to monitor or operate the disk controller <b>31</b> and a plurality of volumes <b>32</b>. </p>
<p id="p-0042" num="0046"> The local data center <b>4</b> and the remote data center <b>5</b> respectively have a plurality of disk subsystems <b>40</b>, <b>50</b>. The plurality of disk subsystems <b>40</b>, <b>50</b> have similar configuration as that of the disk subsystems <b>30</b> in the main data center <b>3</b>. </p>
<p id="p-0043" num="0047"> As the host computer <b>10</b> described above, it is possible to use a general-purpose computer system which comprises, as shown in <figref idref="DRAWINGS">FIG. 2</figref> for example, a CPU <b>901</b>, a memory <b>902</b>, an external storage unit <b>903</b> such as magnetic disk, an input unit <b>904</b> such as a keyboard and mouse, an output unit <b>905</b> such as a monitor and printer, a communication control unit <b>906</b> to establish a connection with a network, and a bus <b>907</b> for connecting the each of the above units. </p>
<p id="p-0044" num="0048"> In this computer system, when the CPU <b>901</b> executes a predefined program of the host computer <b>10</b>, which is loaded on the memory <b>902</b>, each function of the host computer <b>10</b> is implemented. In this case, the memory <b>902</b> or the external storage unit <b>903</b> is utilized as the data duplication configuration-storing portion <b>13</b> and the I/O configuration-storing portion <b>14</b>. The disk subsystem <b>30</b> of the main data center <b>3</b> is also used as the external storage unit <b>903</b>. The host computer SVP <b>20</b> is utilized as the input unit <b>904</b> or output unit <b>905</b>. </p>
<p id="p-0045" num="0049"> It is to be noted that a general-purpose computer system as shown in <figref idref="DRAWINGS">FIG. 2</figref> can also be used for the host computer SVP <b>20</b>, the disk subsystem SVPs <b>33</b>, <b>43</b>, <b>53</b> and the disk controllers <b>31</b>, <b>41</b>, <b>51</b>. </p>
<p id="p-0046" num="0050"> Next, the data duplication configuration-storing portion <b>13</b> of host computer <b>10</b> will be explained. </p>
<p id="p-0047" num="0051"> <figref idref="DRAWINGS">FIG. 3</figref> shows information items stored in the data duplication configuration-storing portion <b>13</b>. The data duplication configuration-storing portion <b>13</b> comprises copy group definition data <b>16</b>, copy group relation definition data <b>17</b>, duplication condition data <b>18</b> and disk subsystem configuration data <b>19</b>. </p>
<p id="p-0048" num="0052"> <figref idref="DRAWINGS">FIG. 4</figref> shows an example of data structure of the copy group definition data <b>16</b>. The &#x201c;copy group&#x201d; represents a collection of pairs of the primary volume (copy source) and the secondary volume (copy destination) in the data duplication processing. In the present embodiment, there are generated two copy groups, i.e., a copy group between the main data center <b>3</b> and the local data center <b>4</b>, and a copy group between the local data center <b>4</b> and the remote data center <b>5</b>. If another copy group exists as a target of the data duplication processing, such as the case where the data duplication is carried out in a data center besides the above three data centers, the copy group definition data <b>16</b> is further generated for the additional copy group. </p>
<p id="p-0049" num="0053"> The copy group definition data <b>16</b> includes a copy group number <b>161</b>, a transfer type identifier <b>162</b>, a volume group identifier <b>163</b>, a primary volume data center identifier <b>164</b>, a secondary volume data center identifier <b>165</b>, a related/non-related flag <b>166</b>, and at least one pair data <b>167</b>. </p>
<p id="p-0050" num="0054"> The copy group number <b>161</b> is a number to identify a copy group. The copy group number <b>161</b> may be a unique number inputted by a user from the input unit <b>904</b>. Alternatively, it may be a number obtained by automatic numbering by the data duplication-controlling portion <b>11</b>. The transfer type identifier <b>162</b> is to identify the transfer type, synchronous or asynchronous. The volume group identifier <b>163</b> is to identify a virtual volume group managed by the volume-managing portion <b>12</b>. </p>
<p id="p-0051" num="0055"> The primary volume data center identifier <b>164</b> is to identify the data center, in which the primary volume (copy source) of the pair included in the copy group exists. The secondary volume data center identifier <b>165</b> is to identify the data center in which the secondary volume (copy destination) of the pair included in the copy group exists. It is to be noted as the data center identifiers <b>164</b>, <b>165</b>, for example, the main data center <b>3</b> may be represented by &#x201c;main&#x201d;, the local data center <b>4</b> may be represented by &#x201c;local&#x201d;, and the remote data center <b>5</b> may be represented by &#x201c;remote&#x201d;. The related/non-related flag <b>166</b> is a flag which indicates whether or not a copy group exists, which defines the secondary volume of the pair included in the copy group as a primary volume. That is, it is a flag to identify an existence of a copy group which forms a volume image set <b>6</b> together with the present copy group. </p>
<p id="p-0052" num="0056"> The pair data <b>167</b> is to identify a primary volume (copy source) and a secondary volume (copy destination) which constitute a pair, and the pair data is configured by pairings the primary volume and the secondary volume. Furthermore, if there are a plurality of pairs within one copy group, a plurality of pair data items <b>167</b> are made corresponding to the number of pairs existing in the copy group. </p>
<p id="p-0053" num="0057"> In other words, as shown in <figref idref="DRAWINGS">FIG. 4</figref>, the pair data <b>167</b> comprises as information of the primary volume (copy source), a primary volume number <b>1671</b>, a primary disk subsystem number <b>1672</b>, and a primary VOLSER <b>1673</b>. Similarly, the pair data <b>167</b> as information of the secondary volume (copy destination), a secondary volume number <b>1674</b>, a secondary disk subsystem number <b>1675</b>, and a secondary VOLSER <b>1676</b>. </p>
<p id="p-0054" num="0058"> The volume numbers (primary and secondary) <b>1671</b>, <b>1674</b> are unique numbers which identify the volumes uniquely within the disk subsystem. Furthermore, the disk subsystem numbers (primary and secondary) <b>1672</b>, <b>1675</b> are unique numbers which identity uniquely a plurality of disk subsystems existing in the data center. The VOLSERs (primary and secondary) <b>1673</b>, <b>1676</b> are serial volume numbers for the volume-managing portion <b>12</b> of the host computer <b>10</b> to manage each volume. It is to be noted that the volumes <b>42</b>, <b>52</b> of the local data center <b>4</b> and the remote data center <b>5</b> may not be managed by the volume-managing portion <b>12</b>. In this case, the VOLSERs <b>1673</b>, <b>1676</b> of the volumes <b>42</b>, <b>52</b> respectively included in the local data center <b>4</b> and the remote data center <b>5</b> become space (empty data). </p>
<p id="p-0055" num="0059"> Next, the copy group relation definition data <b>17</b> will be explained. The copy group relation definition data <b>17</b> establishes relations among a plurality of copy groups that are defined in the copy group definition data <b>16</b>. Accordingly, the volume image set <b>6</b> can be defined. </p>
<p id="p-0056" num="0060"> <figref idref="DRAWINGS">FIG. 5</figref> shows an example of data structure of the copy group relation definition data <b>17</b>. The copy group relation definition data <b>17</b> comprises the first copy group number <b>171</b> and the second copy group number <b>172</b>. In the first copy group number <b>171</b>, there is stored a copy group number <b>161</b> of the copy group definition data <b>16</b> where an identifier of the main data center <b>3</b> is stored in the primary volume data center identifier <b>164</b>. In the second copy group number <b>172</b>, there is stored another copy group number <b>161</b> of the copy group definition data <b>16</b>. The copy group definition data <b>16</b> indicated by the another copy group number includes identification information items <b>1671</b> to <b>1673</b> regarding the primary volume (copy source) stored in each pair data <b>167</b>, which respectively correspond to identification information items <b>1674</b> to <b>1676</b> regarding the secondary volume (copy destination) stored in each pair data <b>167</b> of the copy group definition data <b>16</b>, the copy group number of which is stored in the first copy group number <b>171</b>. </p>
<p id="p-0057" num="0061"> In other words, the secondary volume information items <b>1674</b> to <b>1676</b> of each pair data <b>167</b> included in the copy group definition data <b>16</b> of the first copy group number <b>171</b> are respectively equal to the primary volume information items <b>1671</b> to <b>1673</b> of each pair data <b>167</b> included in the copy group definition data <b>16</b> having the second copy group number <b>172</b>. As thus described, related copy group number <b>161</b> is stored in each of the first copy group number <b>171</b> and the second copy group number <b>172</b>, whereby a volume image set <b>6</b> can be defined by establishing a relation between two copy groups. </p>
<p id="p-0058" num="0062"> In the present embodiment, since the data centers are in three stages, the copy group relation definition data <b>17</b> includes the first and the second copy group numbers <b>171</b>, <b>172</b>. However, if the data centers are in four stages, the copy group relation definition data <b>17</b> may further include a third copy group number in addition to the first and the second copy group numbers <b>171</b>, <b>172</b>. </p>
<p id="p-0059" num="0063"> Next, the duplication condition data <b>18</b> will be explained. The duplication condition data <b>18</b> stores a condition for selecting a disk subsystem of the copy destination or the copy source, when a pair is made (i.e., a pair is made between the primary volume of copy source and the secondary volume of copy destination). It is to be noted that the duplication condition data <b>18</b> is used in volume addition processing (see <figref idref="DRAWINGS">FIG. 9</figref>) in the data duplication-controlling portion <b>11</b>, as described below. </p>
<p id="p-0060" num="0064"> <figref idref="DRAWINGS">FIG. 6</figref> shows an example of table which represents the duplication condition data <b>18</b>. The duplication condition data <b>18</b> comprises a selection condition <b>181</b>, in which a selection condition used when the data duplication-controlling portion <b>11</b> selects a disk subsystem is described, and a temporary condition flag <b>182</b> which indicates whether or not the selection condition <b>181</b> is temporarily used only in the present volume addition processing. </p>
<p id="p-0061" num="0065"> The selection condition <b>181</b> includes two types, i.e., a permanent (general) selection conditions <b>103</b>, <b>184</b>, which are previously inputted by a user from the input unit <b>904</b>, and a temporary selection condition <b>185</b> temporarily generated by the data duplication-controlling portion <b>11</b> in the volume addition processing. The permanent selection conditions <b>183</b>, <b>184</b> include a condition necessary for volume management and operations, a restriction in a hardware specification or a restriction in the data duplication-controlling portion <b>11</b>, and the conditions are to be used in all volume addition processing. For example, among the selection conditions as shown in <figref idref="DRAWINGS">Fig. 6</figref>, in the permanent selection conditions <b>183</b>, <b>184</b>, there are described selection conditions in the case of asynchronous remote copy (data duplication between the local center <b>4</b> and the remote data center <b>5</b>). As for the temporary selection condition <b>185</b>, it is generated when the data duplication-controlling portion <b>11</b> executes the volume addition processing, and it is a selection condition used only in the present processing. This temporary selection condition is deleted at the time when the present processing is completed. </p>
<p id="p-0062" num="0066"> The temporary condition flag <b>182</b> is a flag to identify whether the selection <b>181</b> is permanent or temporary. In the present embodiment, the temporary condition flag <b>102</b> being &#x201c;OFF&#x201d; indicates permanent selection conditions <b>183</b>, <b>184</b>. Alternatively, the temporary condition flag <b>182</b> being &#x201c;ON&#x201d; indicates a temporary selection condition <b>185</b>. </p>
<p id="p-0063" num="0067"> Next, the disk subsystem configuration data <b>19</b> will be explained. The disk subsystem configuration data <b>19</b> stores a configuration of the disk subsystem and volume which are target of data duplication processing in the host computer <b>10</b>. </p>
<p id="p-0064" num="0068"> <figref idref="DRAWINGS">FIG. 7</figref> shows an example of data structure of the disk subsystem configuration data <b>19</b>. As illustrated, the disk subsystem configuration data <b>19</b> stores by data center, a data center identifier <b>191</b>, a disk subsystem number <b>192</b>, an unused volume number <b>193</b>, a volume number <b>194</b>, and VOLSER <b>195</b>. The unused volume number <b>193</b> stores the number or volumes which are unused (blank) within the disk subsystem. This unused volume number <b>193</b> initially stores the number of all volumes included in the disk subsystem. When the data duplication-controlling portion <b>11</b> uses the unused volume, for the volume addition processing and the like (see <figref idref="DRAWINGS">FIG. 9</figref>), the number of volumes thus used is subtracted form the unused volume number <b>193</b>. In other words, the disk subsystem where the unused volume number <b>193</b> is &#x201c;0&#x201d;, it indicates that there is no unused volume. </p>
<p id="p-0065" num="0069"> In the example as shown in <figref idref="DRAWINGS">FIG. 7</figref>, the main data center <b>3</b> whose data center identifier <b>191</b> is &#x201c;main&#x201d; includes two disk subsystems, the disk subsystem numbers <b>192</b> of which are respectively &#x201c;1&#x201d; and &#x201c;2&#x201d;. The disk subsystem whose disk subsystem number <b>192</b> is &#x201c;1&#x201d; includes three volumes the volume numbers <b>194</b> of which are &#x201c;00&#x201d;, &#x201c;01&#x201d;, and &#x201c;02&#x201d;, respectively. The VOLSER <b>195</b> of each volume is &#x201c;VOL010&#x201d;, &#x201c;VOL001&#x201d;, and &#x201c;VOL005&#x201d;. Since the unused volume <b>193</b> is &#x201c;0&#x201d;, there is no volume that is unused, as for those volumes. </p>
<p id="p-0066" num="0070"> Furthermore, the local data center <b>4</b> whose data center identifier <b>191</b> is &#x201c;local&#x201d; includes a disk subsystem having &#x201c;5&#x201d; as the disk subsystem number <b>192</b>, and this disk subsystem includes a volume whose volume number <b>194</b> is &#x201c;00&#x201d;. Since this volume is not managed by the volume-managing portion <b>12</b>, the VOLSER <b>195</b> is blank (space). Furthermore, the remote data center <b>5</b> whose data center identifier <b>191</b> is &#x201c;remote&#x201d; includes a disk subsystem whose disk subsystem number <b>192</b> is &#x201c;8&#x201d;, and this disk subsystem includes a volume whose volume number <b>194</b> is &#x201c;00&#x201d;. The VOLSER <b>195</b> of this volume is also blank (space). </p>
<p id="p-0067" num="0071"> Next, a flow of processing in the data duplication-controlling portion <b>11</b> will be explained following the flowchart as shown in <figref idref="DRAWINGS">FIG. 8</figref>. </p>
<p id="p-0068" num="0072"> The data duplication-controlling portion <b>11</b> executes the data duplication processing periodically, every constant time period or cycle (for example, once a day, once a week, and the like). Alternatively, the data duplication-controlling portion <b>11</b> receives a user instruction from the input unit <b>904</b>, and executes the data duplication processing. When there is a change in a volume group managed by the volume-managing portion <b>12</b>, the volume-managing portion <b>12</b> instructs the data duplication-controlling portion <b>11</b> to execute the data duplication processing. Then, the data duplication-controlling portion <b>11</b> receives this execution instruction, and executes the data duplication processing. </p>
<p id="p-0069" num="0073"> firstly, the data duplication-controlling portion <b>11</b> reads out the copy group relation definition data <b>17</b> from the data duplication configuration-storing portion <b>13</b>, and obtains the first copy group number <b>171</b> (S<b>801</b>). Then, the data duplication-controlling portion <b>11</b> reads out from the data duplication configuration-storing portion <b>13</b>, the copy group definition data <b>16</b> having the copy group number thus obtained, and further obtains a volume group identifier <b>163</b> of the copy group definition data <b>16</b> thus road out (S<b>802</b>). </p>
<p id="p-0070" num="0074"> Next, the data duplication-controlling portion <b>11</b> obtains from the volume-managing portion <b>12</b>, a VOLSER list of the volume group identifier <b>163</b> thus obtained (S<b>803</b>). The VOLSER list is a list which the volume-managing portion <b>12</b> holds by volume group, and it is a catalogue of VOLSERs of the volumes included in each volume group. </p>
<p id="p-0071" num="0075"> Then, the data duplication-controlling portion <b>11</b> compares the VOLSER registered in the VOLSER list obtained in S<b>803</b>, and primary VOLSER <b>1673</b> of each pair data <b>167</b> included in the copy group definition data <b>16</b> which is read out in S<b>802</b> (S<b>804</b>). Then, the data duplication-controlling portion <b>11</b> determines whether or not there exists a volume as to which the data volume addition processing is to be executed (S<b>805</b>). In other words, the data duplication-controlling portion <b>11</b> determines whether or not all the VOLSERs stored in the VOLSER list are stored in the primary VOLSER <b>1673</b> of the pair data <b>167</b>. </p>
<p id="p-0072" num="0076"> If there is a VOLSER that is included in the VOLSER list, but not stored in any of the primary VOLSER <b>1673</b> of the pair data <b>167</b> (S<b>805</b>: YES), it indicates that a volume to be used in the business processing in the host computer <b>10</b> is added, but a data duplication processing has not been carried out yet against thus added volume. Therefore, the data duplication-controlling portion <b>11</b> executes a process for adding a volume of the pertinent VOLSER to the copy group definition data <b>16</b> (S<b>806</b>). This volume addition processing (S<b>806</b>) will be described below with reference to <figref idref="DRAWINGS">FIG. 9</figref>. </p>
<p id="p-0073" num="0077"> On the other hand, all the VOLSERs included in the VOLSER list are respectively stored in any of the primary VOLSER <b>1673</b> of the pair data <b>167</b> (S<b>805</b>: NO), the data duplication-controlling portion <b>11</b> determines whether or not there is a volume to be deleted from the copy group definition data <b>16</b> (S<b>807</b>) In other words, if there is a VOLSER which is stored in the primary VOLSER <b>1673</b> of the pair data <b>167</b>, and not stored in the VOLSER list (S<b>807</b>; YES), it indicates that the data duplication processing is performed against a volume which becomes unnecessary in the business processing. Therefore, the data duplication-controlling portion <b>11</b> carries out a process for deleting the pair data <b>167</b> having the volume of the pertinent VOLSER, from the copy group definition data <b>16</b> (S<b>808</b>). This volume deletion processing (S<b>808</b>) will be described with reference to <figref idref="DRAWINGS">FIG. 10</figref>. </p>
<p id="p-0074" num="0078"> On the other hand, if all the VOLSERs stored in the primary VOLSER <b>1673</b> of the pair data <b>167</b> are stored in the VOLSER list (S<b>807</b>: NO), VOLSERs in the VOLSER list and the primary VOLSERs <b>1673</b> of the pair data <b>167</b> held by the copy group definition data <b>16</b> are respectively identical to each other. Therefore, the data duplication-controlling portion <b>11</b> completes the data duplication-control processing, without executing the volume addition processing (S<b>8</b>O<b>6</b>) or the volume deletion processing (S<b>808</b>). </p>
<p id="p-0075" num="0079"> Then, the data duplication-controlling portion <b>11</b> is in a state of &#x201c;WAIT&#x201d;, until the next start-up timing (for example, at the next start-up cycle, upon receipt of execution instruction from a user or the volume-managing portion <b>12</b>, and the like). </p>
<p id="p-0076" num="0080"> Next, a flow of the aforementioned volume addition processing (S<b>806</b>) will be explained following the flowchart as shown in <figref idref="DRAWINGS">FIG. 9</figref>. </p>
<p id="p-0077" num="0081"> At first, the data duplication-controlling portion <b>11</b> reserves a region in the data duplication configuration-storing portion <b>13</b>, for adding the pair data <b>167</b> in the copy group definition data <b>16</b>, which is a target for processing. Then, primary volume information (copy source) of thus added pair data <b>167</b> is set (S<b>901</b>). In other words, the data duplication-controlling portion <b>11</b> sets in the primary VOLSER <b>1673</b>, a VOLSER that is determined to be added in S<b>806</b>. Then, the data duplication-controlling portion <b>11</b> reads out the disk subsystem configuration data <b>19</b>, and obtains a volume number <b>194</b> and a disk subsystem number <b>192</b> of the VOLSER thus set. Then, the obtained volume number <b>194</b> and the disk subsystem number <b>192</b> are respectively set in the primary volume number <b>1671</b> and the primary disk subsystem number <b>1672</b>. </p>
<p id="p-0078" num="0082"> Then, the data duplication-controlling portion <b>11</b> obtains from the copy group definition data <b>16</b> which is a target of processing, a secondary volume data center identifier <b>165</b> as a copy destination (S<b>902</b>). Next, the data duplication-controlling portion <b>11</b> reads out the disk subsystem configuration data <b>19</b>, and obtains the disk subsystem data <b>192</b> to <b>195</b> held by the data center identifier <b>191</b> identical to the data center identifier <b>165</b> thus obtained (S<b>903</b>). Then, the data duplication controlling portion <b>11</b> determines whether or not there is a disk subsystem available for being selected as a copy destination, based on the obtained disk subsystem information <b>192</b> to <b>195</b> (S<b>904</b>). </p>
<p id="p-0079" num="0083"> In other words, the data duplication-controlling portion <b>11</b> firstly extracts a disk subsystem which has an unused volume. It is determined whether or not there is an unused volume in a disk subsystem, by referring to the value of the unused volume number <b>193</b> of the disk subsystem configuration data <b>19</b>. The disk subsystem having the value other than &#x201c;0&#x201d; is extracted, since it indicates that there is an unused volume. If the unused volume number <b>193</b> of a disk subsystem is &#x201c;0&#x201d;, it indicates that the disk subsystem does not include an unused volume, and thus it cannot be selected as a copy destination subsystem. </p>
<p id="p-0080" num="0084"> Then, the data duplication-controlling portion <b>11</b> selects a disk subsystem which satisfies a condition described in the selection condition <b>181</b> of the duplication condition data <b>18</b>. For example, in the duplication condition data <b>18</b> as shown in <figref idref="DRAWINGS">FIG. 6</figref>, if the transfer type identifier <b>162</b> or the copy group definition data <b>16</b> as a processing target is synchronous remote copy, any of the constant selection conditions <b>183</b> and <b>184</b> is not applicable. Therefore, it is possible to select a disk subsystem having an unused volume, without being restricted by the constant selection conditions <b>183</b>, <b>184</b>, which are stored in the duplication condition data <b>18</b>. On the other hand, if the transfer type identifier <b>162</b> of the copy group definition data <b>16</b> as a processing target is asynchronous remote copy, both of the constant selection conditions <b>183</b> and <b>184</b> are applicable. Therefore, a disk subsystem which satisfies those constant selection conditions <b>183</b>, <b>184</b> is selected. It is to be noted if there are a plurality or disk subsystem selectable as a copy destination, any one of the disk subsystem numbers is selected, in accordance with a predefined rule, such as selecting a disk subsystem having the smallest disk subsystem number <b>192</b>. </p>
<p id="p-0081" num="0085"> If there is a disk subsystem as a candidate of the copy destination (S<b>904</b>: YES), the data duplication-controlling portion <b>11</b> determines whether or not a secondary volume as a copy destination can he obtained from the pertinent disk subsystem (S<b>905</b>). A method for obtaining the secondary volume is same as the method for selecting a secondary volume described in the Patent Document 1. In other words, according to the instruction for selecting a secondary volume from the data duplication-controlling portion <b>11</b>, the disk controller <b>31</b> selects a volume unused and having a disk volume larger than that of the primary volume, and notifies the data duplication-controlling portion <b>11</b> of thus selected volume. </p>
<p id="p-0082" num="0086"> If the secondary volume is normally obtained (S<b>905</b>: YES), the data duplication-controlling portion <b>11</b> sets the information of thus obtained secondary volume, in the secondary volume information (copy destination) of the pair data reserved in S<b>901</b> (S<b>906</b>). In other words, the volume number <b>1674</b> and the dial subsystem number <b>1675</b> of the pertinent secondary volume is set. Then, the data duplication-controlling portion <b>11</b> issues a pair making setting command for the newly generated pair as the pair data <b>167</b>, to the disk subsystem of the primary volume (copy source) and the disk subsystem of the secondary volume (copy destination) (S<b>907</b>). It is to be noted that this pair making setting command is same as a pair making command for the &#x201c;pair making&#x201d; as described in the Patent Document 1. That is, the pair making command triggers off a updating of internal information in the disc subsystem and execution of a copy-making. </p>
<p id="p-0083" num="0087"> Then, the data duplication-controlling portion <b>11</b> determines whether or not the setting command has been successful (S<b>908</b>). If the setting command has been successful (S<b>908</b>: YES), the data duplication-controlling portion <b>11</b> determines whether or not there exists a copy group related with the copy group definition data <b>16</b> as a processing target (S<b>909</b>). Specifically, the data duplicate-controlling portion <b>11</b> refers to the related/non-related flag <b>166</b> of the copy group definition data <b>16</b>, and determines whether or not there is a related copy group. </p>
<p id="p-0084" num="0088"> If there exists a related copy group (S<b>909</b>: YES), it indicates that a volume image set <b>6</b> is in process of being generated. Specifically, it indicates a status that even after the pair data <b>167</b> is defined between the disk subsystem <b>30</b> of the main data center <b>3</b> and the disk subsystem <b>40</b> of the local data center <b>4</b>, the pair data <b>167</b> between the disk subsystem <b>40</b> of the local data center <b>4</b> and the disk subsystem <b>50</b> of the remote data center <b>5</b> has not been defined yet. Therefore, it is necessary to execute a volume addition processing continuously. </p>
<p id="p-0085" num="0089"> If there is a related copy group (S<b>909</b>: YES), the data duplication-controlling portion <b>11</b> refers to the copy group relation definition data <b>17</b>, and obtains a second copy group number <b>172</b> having as the first copy group number <b>171</b>, the copy group number <b>161</b> of the pertinent copy group (S<b>910</b>). Then, the process returns to S<b>901</b>, and the data duplication-controlling portion <b>11</b> carries out the volume addition processing again against the copy group having the second copy group number, which is obtained in S<b>910</b>. In this case, the data duplication-controlling portion <b>11</b> sets the volume information of copy destination of the pair data <b>167</b> generated in S<b>906</b>, as primary volume information (copy source) of the pair data <b>167</b>, for which a region is newly reserved. </p>
<p id="p-0086" num="0090"> Furthermore, if there is not a disk subsystem satisfying the duplication condition data <b>18</b> and the like (S<b>904</b>: NO), the data duplication-controlling portion <b>11</b> determines whether or not the copy group as a processing target is a head of the volume image set <b>6</b> (S<b>911</b>). In other words, the data duplication-controlling portion <b>11</b> determines whether or not the copy group number <b>161</b> of the copy group definition data <b>16</b> as a processing target is stored in the second copy group number <b>172</b> of the copy group relation definition data <b>17</b>. If the copy group number <b>161</b> as a processing target is stored in the second copy group number <b>172</b>, the data duplication-controlling portion <b>11</b> determines that the pertinent copy group is not a head of the volume image set <b>6</b>. On the other hand, if the copy group number <b>161</b> as a processing target is not stored in the second copy group number <b>172</b>, the data duplication-controlling portion <b>11</b> determines that the pertinent copy group is a head of the volume image set <b>6</b>. </p>
<p id="p-0087" num="0091"> If the copy group as a processing target is a head of the volume image set <b>6</b> (S<b>911</b>: YES), that is, if it is a pair making between the main data center <b>3</b> and the local data center <b>4</b>, the data duplication-controlling portion <b>11</b> outputs an error in the host computer SVP <b>20</b> which is an output unit <b>905</b> (S<b>914</b>). </p>
<p id="p-0088" num="0092"> On the other hand, if the copy group as a processing target is not a head of the volume image set <b>6</b> (S<b>911</b>: NO), or a secondary volume cannot be obtained (S<b>905</b>: NO), or a setting command has failed (S<b>908</b>), it is necessary that the process returns to S<b>901</b>, and the volume addition processing (S<b>806</b>) is executed again. Therefore, the data duplication-controlling portion <b>11</b> adds the information which is a cause of error to the duplication condition data <b>18</b> (S<b>912</b>). In other words, the data duplication-controlling portion <b>11</b> adds the information as to the disk subsystem in error to the selection condition <b>181</b> of the duplication condition data <b>18</b>, so that the disk subsystem in error cannot be selected. At that timing, the temporary condition flag <b>182</b> is set to &#x201c;ON&#x201d;. For example, as shown in <figref idref="DRAWINGS">FIG. 6</figref>, a temporary selection condition <b>185</b> is added, such as &#x201c;the disk subsystem number &#x201c;5&#x201d; with the data center identifier being &#x201c;local&#x201d; cannot be selected&#x201d;. </p>
<p id="p-0089" num="0093"> It is noted that when the setting command has failed (S<b>908</b>), it is conceivable that a failure occurs in the disk subsystem that issued a command. Therefore, the data duplication-controlling portion <b>11</b> adds to the duplication condition data <b>18</b>, the information of the disk subsystem where the failure has occurred, as a temporary selection condition, so that such subsystem cannot be selected. </p>
<p id="p-0090" num="0094"> Furthermore, if the copy group as a processing target is not a head of the volume image <b>6</b> (S<b>911</b>: NO), a selection of the disk subsystem in the copy group at the head of the volume image set <b>6</b> causes an error. The selection of the disk subsystem in the copy group at the head causes such an error, because of the reasons as the following: As described above, in the example of constant conditions <b>183</b>, <b>184</b> of the duplication condition data <b>18</b> (see <figref idref="DRAWINGS">FIG. 6</figref>), conditions in the case of asynchronous transfer are described. Therefore, if the head copy group is based on synchronous transfer, the constant conditions <b>183</b>, <b>184</b> are not applicable. However, if related copy group is based on asynchronous transfer, those constant conditions <b>183</b>, <b>184</b> are applicable. For example, if a different disk subsystem is selected as a secondary volume in the volume addition processing for the head copy group, the selected disk subsystem becomes a primary volume of the related copy group. Therefore, it does not satisfy the constant condition <b>183</b>. </p>
<p id="p-0091" num="0095"> Then, the data duplication-controlling portion <b>11</b> refers to the copy group relation definition data <b>17</b>, and obtains a first copy group number <b>171</b> that has the copy group number <b>161</b> of the copy group definition data <b>16</b> as a processing target, as a second copy group number <b>172</b>. Subsequently, the data duplication-controlling portion <b>11</b> defines the copy group definition data <b>16</b> of thus obtained first copy group number as a copy group to be processed next. Then, the data duplication-controlling portion <b>11</b> issues to tho disk subsystem, a pair deleting setting command for deleting the pair making setting command which has been issued against the head copy group in S<b>907</b> (S<b>913</b>). Furthermore, the data duplication-controlling portion <b>11</b> deletes the pair data <b>167</b> generated in the volume addition processing in the head copy group. It is to be noted here that this pair deleting setting command is same as the deleting command for &#x201c;pair deletion&#x201d; destined in the Patent Document 1. That is, the internal information of the disk subsystem is updated to render the status as &#x201c;no pair making&#x201d;. </p>
<p id="p-0092" num="0096"> Subsequently, the data duplication-controlling portion <b>11</b> returns the process to S<b>901</b>, and the volume addition processing (S<b>806</b>) is executed again for the head copy group. </p>
<p id="p-0093" num="0097"> After error information is outputted due to a failure in the volume addition processing (S<b>914</b>), or the volume addition processing is successful and no other relating copy group exists (S<b>909</b>: NO), the data duplication controlling portion <b>11</b> deletes the temporary selection condition <b>185</b> with a temporary condition flag <b>182</b> &#x201c;ON&#x201d;, which has bean added to the duplication condition data <b>18</b> (S<b>915</b>), and the volume addition processing is completed. </p>
<p id="p-0094" num="0098"> Next, a flow of the aforementioned volume deletion processing (S<b>808</b>) will be explained following the flowchart as shown in <figref idref="DRAWINGS">FIG. 10</figref>. </p>
<p id="p-0095" num="0099"> The data duplication-controlling portion <b>11</b> determines whether or not the copy group decided to be deleted in S<b>808</b> has a related copy group, by referring to the related/non-related flag <b>166</b> (S<b>1001</b>). Then, if it has a related copy group (S<b>1001</b>: YES), the data duplication-controlling portion <b>11</b> obtains a copy group number of the related copy group and pair data <b>167</b> as a target of the deletion processing (S<b>1002</b>). In other words, the data duplication-controlling portion <b>11</b> refers to the copy group relation definition data <b>17</b>, and obtains a second copy group number which has the copy group number as a processing target, as the first copy group number <b>171</b>. Furthermore, the data duplication controlling portion <b>11</b> obtains a secondary volume of the volume (primary volume) to be deleted. Then, the data duplication-controlling portion <b>11</b> refers to the copy group definition data <b>16</b> of thus obtained copy group number, and obtains pair data <b>167</b> in which the secondary volume (copy destination) of the primary volume (copy source) to be deleted is defined as a primary volume (copy source). </p>
<p id="p-0096" num="0100"> Then, the data duplication-controlling portion <b>11</b> returns the process to S<b>1001</b>, and determines again whether or not the copy group decided to be deleted has a related copy group (S<b>1001</b>). If it does not have a related copy group (S<b>1001</b>: NO), the data duplication-controlling portion <b>11</b> issues to the disk subsystem, a pair deleting setting command to delete the pair of the pair data <b>167</b> including a volume to be deleted (or a secondary volume (copy destination) of the volume to be deleted) (S<b>1003</b>). </p>
<p id="p-0097" num="0101"> Then, the data duplication-controlling portion <b>11</b> determines whether or not the pair deleting setting command has been successful (S<b>1004</b>). When the pair deleting setting command has been successful (S<b>1004</b>: YES), the data duplication-controlling portion <b>11</b> deletes from the copy group definition data <b>16</b>, the pair data <b>167</b> as to which the deleting setting command has been issued (S<b>1005</b>). Subsequently, the data duplication-controlling portion <b>11</b> determines whether or not there is a copy group to be deleted next (S<b>1006</b>). In other words, when the data duplication-controlling portion <b>11</b> obtains a related copy group in S<b>1002</b>, it stores a copy group number and pair data to be deleted at the present timing, in the memory <b>902</b> or in the external storage unit <b>903</b>. Then, the data duplication controlling portion <b>11</b> determines whether or not there is a copy group to be deleted next by use of those information items. </p>
<p id="p-0098" num="0102"> If there is a copy group to be deleted next (S<b>1006</b>: YES), the data duplication-controlling portion <b>11</b> obtains the copy group number and the pair data <b>167</b> stored in S<b>1002</b> (S<b>1007</b>), and it returns the process to S<b>1003</b> and issues a pair deleting setting command. Alternatively, if there is no copy group to be deleted (S<b>1006</b>: NO), the volume deletion processing is completed. Furthermore, if the pair deleting setting command failed (S<b>1004</b>: NO), the data duplication-controlling portion <b>11</b> outputs an error to the host computer SVP <b>20</b> which is an output unit <b>905</b>, and ends the volume deleting processing. </p>
<p id="p-0099" num="0103"> In the description above, one embodiment of the present invention has been explained. </p>
<p id="p-0100" num="0104"> In the present embodiment, if there is a change in volume group managed by the host computer <b>10</b>, it is possible to carry out immediately the date duplication processing against thus changed volume. Accordingly, data consistency is secured, whereby consistency of the data within the volume groups can be maintained. </p>
<p id="p-0101" num="0105"> Furthermore, even if there are multiple disk subsystems, an appropriate subsystem can be selected as a copy destination for duplicating data. </p>
<p id="p-0102" num="0106"> In addition, even if the system configuration is complicated due to a plurality of data copy destinations, such as the main data center <b>3</b>, the local data center <b>4</b>, and the remote center <b>5</b>, it is possible to select an appropriate disk system as a copy destination for data duplication, by adding a temporary selection condition to the duplication condition data <b>18</b>, whereby the data duplication processing can be easily implemented. </p>
<p id="p-0103" num="0107"> It is to be noted that the present invention is not limited to the above embodiment, and various modifications may be possible without departing from the scope of the present invention. </p>
<p id="p-0104" num="0108"> For example, in the embodiment above, there is explained a case that only one volume group is managed by the volume-managing portion <b>12</b>, and the data within the volume group is duplicated to the main data center <b>3</b>, the local data center <b>4</b> and the remote data center <b>5</b>. However, it is possible to consider a case where multiple volume groups exist. In this case, multiple copy group relation definition data items <b>17</b> are generated, the number of which is equal to that of the existing volume groups. </p>
<p id="p-0105" num="0109"> In the embodiment above, it is defined that the disk subsystem configuration data <b>19</b> is previously stored in the data duplication configuration-storing portion <b>13</b>, prior to executing the data duplication processing. However, it is possible to configure such that each disk subsystem obtains the disk subsystem configuration data <b>19</b>. That is, the data duplication-controlling portion <b>11</b> issues a pair making command between the local data center <b>4</b> and the remote data center <b>5</b> via the main data center <b>3</b>. In such a manner, it is possible for the data duplication-controlling portion <b>11</b> to obtain the disk subsystem configuration data of the local data center <b>4</b> and the remote data center <b>5</b> via the main data center <b>3</b>. Alternatively, without through the main data center <b>3</b>, the data duplication-controlling portion <b>11</b> may directly obtain the disk subsystem configuration data by setting a communication path and the like from the host computer <b>10</b> to the disk subsystem SVP <b>43</b>, <b>53</b> of the data centers <b>4</b> and <b>5</b>, respectively. </p>
<p id="p-0106" num="0110"> Further in the computer system of the embodiment above, it is possible to configure such that a management computer for managing the overall computer system is provided, in addition to the host computer system <b>1</b>. <figref idref="DRAWINGS">FIG. 11</figref> is a schematic diagram showing a computer system to which provides a management computer. </p>
<p id="p-0107" num="0111"> For the management computer, a general-purpose computer system as shown in <figref idref="DRAWINGS">FIG. 2</figref> can be used, and it is connected to the computer system of the above embodiment via the network. In this case, the management computer carries out a part of or all of the processes executed by the host computer system <b>1</b> of the above embodiment. For example, in the above embodiment, a user inputs the duplication condition data <b>18</b> from the input unit <b>904</b> of the host computer system <b>1</b>. However, it is also possible to configure such that the user inputs the duplication condition data <b>18</b> from the input unit of the management computer. Then, the management computer notifies the host computer system <b>1</b> of the duplication condition data <b>18</b> thus inputted. </p>
<p id="p-0108" num="0112"> Furthermore, the management computer may carry out the data duplication processing as shown in <figref idref="DRAWINGS">FIG. 8</figref>, on behalf of the host computer system <b>1</b>. In other words, the management computer obtains information (copy group definition data <b>16</b>, disk subsystem configuration data <b>19</b> and the like) stored in the data duplication configuration-storing portion <b>13</b> of the host computer <b>1</b>, via the network. Then, the management computer executes the data duplication processing based on the data stored in the data duplication configuration-storing portion <b>13</b>, and transmits to the host computer system <b>1</b>, the data of the data duplication configuration-storing portion <b>13</b> that has been updated by the processing. Then, the host computer system <b>1</b> receives the updated information of the data duplication configuration-storing portion <b>13</b>, and transmits a command and the like, to the disk subsystems <b>30</b>, <b>40</b>, <b>50</b> and so on, to instruct a generation of a copy group in accordance with the contents of update. </p>
<p id="p-0109" num="0113"> Furthermore, it is also possible to configure such that the management computer may receive from a user a volume addition instruction against the volume-managing portion <b>12</b> of the host computer system <b>1</b>. In this case, the management computer can detect an addition of volume in advance. Therefore, the management computer carries out the volume addition processing of the aforementioned data duplication processing (see <figref idref="DRAWINGS">FIG. 9</figref>), by use of the copy group definition data <b>16</b> and the like obtained from the host computer system <b>1</b>. Then, the management computer transmits the result of the processing to the host computer <b>1</b> together with an instruction for volume addition. Accordingly, it is not necessary for the host computer <b>1</b> to search for a presence or non-presence of volume addition, and a processing in the entire system becomes simple. </p>
<p id="p-0110" num="0114"> Furthermore, the management computer may control the execution of starting or stopping operations by the data duplication-controlling portion <b>11</b> of the host computer system <b>1</b>. </p>
<p id="p-0111" num="0115"> It is further possible for the host computer system <b>1</b> or the management computer to have a graphical user interface (GUI) to simplify data inputting by a user. <figref idref="DRAWINGS">FIG. 12</figref> is a diagram showing an example of GUI to which the host computer system <b>1</b> or the management computer has. For example, this GUI displays on the output unit <b>905</b> the disc subsystems <b>30</b>, <b>40</b> and <b>50</b> connected with the host computer system <b>1</b>, following the connection topology. Then, the GUI receives a user instruction, creates information to generate a copy group in any of the instructed disk subsystems <b>30</b>, <b>40</b>, and <b>50</b>, and makes an instruction to the data duplication-controlling portion <b>11</b>. Furthermore, by use of the GUI, the copy group information between the disk subsystems may be visually displayed on the output unit <b>905</b>. Accordingly, the user can select individual copy groups by way of the GUI interface, whereby it is easy to instruct the host computer system <b>1</b> to generate the volume image set <b>6</b>. </p>
<?detailed-description description="Detailed Description" end="tail"?>
</description>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text><b>1</b>. A data duplication method which duplicates data being stored in a storage subsystem connected to a computer, wherein, 
<claim-text>said computer includes a processor unit and a storing unit, and said processor unit comprises, </claim-text>
<claim-text>an identification information reading step which reads out from a storing unit an identification information list in which identification information of each of a plurality of storage media included in the storage subsystem is stored, </claim-text>
<claim-text>a first reading step which reads out from the storing unit, the first duplication definition information which stores the identification information with respect to each of the plurality of storage media, and identification information of a copy destination storage medium of each of the plurality of storage media, </claim-text>
<claim-text>a first comparing step which compares the identification information list read out in the identification information reading step, and the first duplication definition information read out in the first reading step, </claim-text>
<claim-text>an addition step in which if there exists identification information that is stored in the identification information list but not stored in the first duplication definition information in the first comparing step, a copy destination recording medium of the storage medium having the identification information is selected according to a predetermined selection condition, the identification information and the identification information of the copy destination storage medium thus selected are added to the first duplication definition information, and data in the storage medium having the identification information is copied to the copy destination storage medium thus selected, and </claim-text>
<claim-text>a deletion step in which if there exists identification information that is not stored in the identification information list but is stored in the first duplication definition information in the first comparing step, the identification information and the identification information of the storage medium, which is a copy destination of the storage medium having the identification information, are deleted from the first duplication definition information, and copying the data of the storage medium having the identification information is stopped. </claim-text>
</claim-text>
 </claim>
<claim id="CLM-00002" num="00002">
<claim-text><b>2</b>. A data duplication method according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein, 
<claim-text>there exist a plurality of said storage subsystems connected to the computer, and a plurality of said storage subsystems which include said copy destination storage medium. </claim-text>
</claim-text>
 </claim>
<claim id="CLM-00003" num="00003">
<claim-text><b>3</b>. A data duplication method according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein, 
<claim-text>a second reading step which reads out from said storing unit, the second duplication definition information which stores identification information with respect to each of said plurality of storage media as a copy destination, and identification information of a storage medium as a further copy destination of each of said storage media, </claim-text>
<claim-text>a second comparing stop which compares the first duplication definition information read out in said first reading step, and the second duplication definition information read out in said second reading step, </claim-text>
<claim-text>an addition step in which if there exists identification information that is stored in the first duplication definition information but not stored in the second duplication definition information in the second comparing step, a further copy destination recording medium of the storage medium having the identification information is selected according to a predetermined selection condition, the identification information and the identification information of the further copy destination storage medium thus selected are added to the second duplication definition information, and data in the storage medium having the identification information is copied to the further copy destination storage medium thus selected, and </claim-text>
<claim-text>a deletion step in which if there exists identification information that is not stored in the first duplication definition information but is stored in the second duplication definition information in the second comparing step, the identification information and the identification information of the storage medium, which is a further copy destination of the storage medium having tho identification information, are deleted from the second duplication definition information, and copying the data of the storage medium having the identification information is stopped. </claim-text>
</claim-text>
 </claim>
<claim id="CLM-00004" num="00004">
<claim-text><b>4</b>. A data duplication method according to <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein, 
<claim-text>said selection condition includes information which has caused an error occurred in said addition step. </claim-text>
</claim-text>
 </claim>
<claim id="CLM-00005" num="00005">
<claim-text><b>5</b>. A program which duplicates data being stored in a storage subsystem connected to a computer, wherein, 
<claim-text>said computer includes a processor unit and a storing unit, and said program allows the processor unit to execute, </claim-text>
<claim-text>an identification information reading step which reads out from a storing unit an identification information list which stores identification information of each of a plurality of storage media included in the storage subsystem, </claim-text>
<claim-text>a definition information reading step which leads out from the storing unit, the duplication definition information which stores the identification information with respect to each of the plurality of storage media, and identification information of a copy destination storage medium of each of the plurality of storage media, </claim-text>
<claim-text>a comparing step which compares the identification information list read out in the identification information reading step, and the duplication definition information read out in the duplication definition reading step, </claim-text>
<claim-text>an addition step in which if there exists identification information that is stored in the identification information list but not stored in the duplication definition information in the comparing step, a copy destination recording medium of the storage medium having the identification information is selected according to a predetermined selection condition, the identification information and the identification information of the copy destination storage medium thus selected are added to the duplication definition information, and data in the storage medium having the identification information is copied to the copy destination storage medium thus selected, and </claim-text>
<claim-text>a deletion step in which if there exists identification information that is not stored in the identification information list but is stored in the duplication definition information in the comparing step, the identification information and the identification information of the storage medium, which is a copy destination of the storage medium having the identification information, are deleted from the duplication definition information, and copying the data of the storage medium having the identification information is stopped. </claim-text>
</claim-text>
 </claim>
<claim id="CLM-00006" num="00006">
<claim-text><b>6</b>. A computer which duplicates data stored in a storage subsystem, comprising, 
<claim-text>a first storing means which stores an identification information list in which identification information of each or a plurality of storage media included in said storage subsystem is stored, </claim-text>
<claim-text>a second storing means which stores duplication definition information including identification information with respect to each of said plurality of storage media, and identification information of a copy destination storage medium of each or said storage media, and </claim-text>
<claim-text>a comparing means which compares the identification information list stored in said first storing means, and the duplication definition information stored in said second storing means, wherein, </claim-text>
<claim-text>if the identification information is stored in said identification information list but not stored in said duplication definition information, said comparing means selects according to a predefined selection condition, a copy destination storage medium of the storage medium having the identification information, adds to said duplication definition information, the identification information and the identification information of said copy destination storage medium thus selected, and copies data in the storage medium having the identification information to said copy destination storage medium thus selected, and </claim-text>
<claim-text>if there exists identification information not stored in said identification information list, but stored in said duplication definition information, said comparing means deletes from said duplication definition information, the identification information and the identification information of the copy destination storage medium of the storage medium having the identification information, and stops copying of data in the storage medium having the identification information.</claim-text>
</claim-text>
 </claim>
</claims>
</us-patent-application>
